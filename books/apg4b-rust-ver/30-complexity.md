---
title: "計算量"
---

# ABC085 C - Otoshidama
[ABC085 C - Otoshidama](https://atcoder.jp/contests/abc085/tasks/abc085_c) を解くことを考えます．

要約すると，「整数 $N, Y$ が与えられるので， $x + y + z = N$ ， $10000x + 5000y + 1000z = Y$ を満たす整数の組 $(x, y, z)$ を探せ」という問題です．

$Y$ と $y$ があるので，以下コード中では $y$ （ $5000$ 円札の枚数）を変数 `y` で， $Y$ （金額の合計）を変数 `sum` で表します．

## 解法 1

$x + y + z = N$ なので， $x, y, z$ は全て $0, 1, 2, \ldots, N$ のいずれかです．よって， 3 重の `for` 式を書いて $x, y, z$ をそれぞれ $0, 1, 2, \ldots, N$ の範囲で動かせば，その中に答えがあります．これをそのままコードに書くと，次のようになります．
```rust
use proconio::input;

fn main() {
    input! {
        n: i32,
        sum: i32,
    }
    for x in 0..=n {
        for y in 0..=n {
            for z in 0..=n {
                if x + y + z == n && x * 10000 + y * 5000 + z * 1000 == sum {
                    println!("{} {} {}", x, y, z);
                    return;
                }
            }
        }
    }
    println!("-1 -1 -1");
}
```

これを実際に提出したものが[これ](https://atcoder.jp/contests/abc085/submissions/20495800)です． AC の代わりに TLE と表示されています．

AC や WA ， TLE といった表示の意味は[このページ](https://atcoder.jp/contests/practice/glossary)に書いてあります．これを見ると， TLE は「問題で指定された実行時間以内にプログラムが終了しなかった」という意味だと分かります．今回の場合，問題文の上部に「実行時間制限: 2 sec 」と書いてあるので，提出したコードは 2 秒以内に終了しなかったということになります．よって，コードを書き換えてプログラムをもっと高速にしなければなりません．

## 解法 2
$x + y + z = N$ という条件を見ると， $x$ ， $y$ を決めたとき， $z$ の値として考えられるのは $z = N - x - y$ しかありません．よって，

- $x, y$ をそれぞれ $0, 1, 2, \ldots, N$ の範囲で動かす
- $z = N - x - y$ として， $10000x + 5000y + 1000z = Y$ が成り立っているか調べる

というやり方で答えを求めることもできます．ただし， $z < 0$ となる場合があるので除外します．

この解法で実際にコードを書き，提出してみてください．正しく書くことができれば，[この提出](https://atcoder.jp/contests/abc085/submissions/20495767)のように AC となるはずです．

## アルゴリズム
ある処理の内容を形式的な手続きとして言い表したものを，**アルゴリズム**といいます．

解法 1 のアルゴリズムは，

- $x, y, z$ をそれぞれ $0, 1, 2, \ldots, N$ の範囲で動かす．
- $x + y + z = N$ ， $10000x + 5000y + 1000z = Y$ が成り立っていれば， $x, y, z$ の値を出力して終了する．
- $x, y, z$ が全ての範囲を動いても終了しなかったら， `-1 -1 -1` と出力する．

のように言い表され，解法 2 のアルゴリズムは

- $x, y$ をそれぞれ $0, 1, 2, \ldots, N$ の範囲で動かす．
- $z = N - x - y$ としたときに $z \geq 0$ ， $10000x + 5000y + 1000z = Y$ が成り立っていれば， $x, y, z$ の値を出力して終了する．
- $x, y$ が全ての範囲を動いても終了しなかったら， `-1 -1 -1` と出力する．

のように言い表されます．解法 1 が TLE ，解法 2 が AC だったということは，解法 1 のアルゴリズムより解法 2 のアルゴリズムの方が高速だということを意味します．では，後者は前者より*どのくらい*速いのでしょうか？これを考えるための道具となるのが，**計算量**の概念です．

# 計算量

四則演算やビット演算，数同士の比較，値のコピーといった一つ一つの処理が，プログラムの開始から終了までの間に行われる回数を，**計算量**といいます．

たとえば，解法 1 のアルゴリズムでは， $x + y + z = N$ と $10000x + 5000y + 1000z = Y$ を確かめる間に何度かの足し算と掛け算と比較が行われ，それが $(N + 1)^3$ 回繰り返されます．一方，解法 1 のアルゴリズムでは， $z = N - x - y$ を計算して $z \geq 0$ と $10000x + 5000y + 1000z = Y$ を確かめる間に何度かの足し算と掛け算が行われ，それが $(N + 1)^2$ 回繰り返されます．

問題を見ると，制約のところに $1 \leq N \leq 2000$ と書いてあります． $(N + 1)^3$ 回の繰り返しが起こる解法 1 のアルゴリズムと $(N + 1)^2$ 回の繰り返しが起こる解法 2 のアルゴリズムの間で，計算量の違いが最も顕著になるのは， $N$ が最大のときです．このとき $N = 2000$ なので， $(N + 1)^3$ は $(N + 1)^2$ のおおよそ $2000$ 倍となります．細かい演算や比較の回数を無視すれば，解法 2 のアルゴリズムは解法 1 のアルゴリズムよりおおよそ $2000$ 倍高速に動くということです．

ここで，「おおよそ」 $2000$ 倍という表現を使いました．計算量について考えるとき，実際に正確な計算の回数を考えることはなく，普通おおよその回数だけを考えます．ここで，おおよその数を表すために**ランダウの $O$** と呼ばれる記号を使います．

## ランダウの $O$

$N$ の関数 $f(N)$ と $g(N)$ があったとき，次を満たすような定数 $c$ と $n$ を見つけることができるなら， $f(N) = O(g(N))$ と書きます．

- $N = n, n + 1, n + 2, n + 3, \ldots$ の全てについて， $|f(N)| \leq c\cdot|g(N)|$ が成り立つ．

具体的な例を用いて考えてみましょう． $f(N) = 2N + 5$ ， $g(N) = N$ とします．このとき，条件を満たすような $c$ と $n$ の例として，たとえば $c = 3$ ， $n = 5$ があります．なぜなら， $N = 5, 6, 7, \ldots$ の全てについて， $|2N + 5| \leq 3|N|$ が成り立つからです．よって， $2N + 5 = O(N)$ と書けます．

一方， $f(N) = N^2$ ， $g(N) = N$ とします．このとき，どんな $c$ を考えてたとしても，不等式 $|N^2| \leq c\cdot|N|$ は $N$ を大きくするといつか成り立たなくなってしまいます．よって， $N^2 = O(N)$ ではありません．

いくつか練習問題を置いておくので，解いてみてください．

1. $N = O(N)$ ですか？
   :::details 答え
   **はい**．具体的には， $c = 1$ ， $n = 1$ とすると $N = 1, 2, 3, \ldots$ の全てについて $|N| \leq |N|$ が成り立ちます．
   :::
1. $2N + 1 = O(N^2)$ ですか？
   :::details 答え
   **はい**．具体的には， $c = 1$ ， $n = 3$ とすると $N = 3, 4, 5, \ldots$ の全てについて $|2N + 1| \leq |N^2|$ が成り立ちます．
   :::
1. $N = O(1)$ ですか？
   :::details 答え
   **いいえ**． $c$ をどれだけ大きくしても， $N > c$ なら $|N| \leq c\cdot |1|$ は成り立ちません．
   :::
1. $5 = O(1)$ ですか？
   :::details 答え
   **はい**． $c = 5$ とすれば， $N$ に関わらず $|5| \leq 5 \cdot |1|$ が成り立ちます．
   :::
1. $a$ を正の定数とします． $f(N) = O(g(N))$ ならば $af(N) = O(g(N))$ ですか？
   :::details 答え
   **はい**．

   $f(N) = O(g(N))$ より，ある $c$ と $n$ が存在して， $N = n, n + 1, n + 2, \ldots$ の全てについて $|f(N)| \leq c\cdot|g(N)|$ が成り立ちます．

   ここで $c' = ac$ とおくと， $N = n, n + 1, n + 2, \ldots$ の全てについて

   $$
   \begin{aligned}
   |af(N)|
   &= a \cdot |f(N)| \\
   &\leq a \cdot c \cdot |g(N)| \\
   &= c' \cdot |g(N)|
   \end{aligned}
   $$

   が成り立ちます．こうして，条件を満たす $c'$ と $n$ を見つけることができたので， $af(N) = O(g(N))$ です．
   :::
1. $f(N) = f_1(N) + f_2(N)$ とします． $f_1(N) = O(g(N))$ かつ $f_2(N) = O(g(N))$ ならば $f(N) = O(g(N))$ ですか？
   :::details 答え
   **はい**．

   $f_1(N) = O(g(N))$ より，ある $c_1$ と $n_1$ が存在して， $N = n_1, n_1 + 1, n_1 + 2, \ldots$ の全てについて $|f_1(N)| \leq c_1\cdot|g(N)|$ が成り立ちます．一方， $f_2(N) = O(g(N))$ より，ある $c_2$ と $n_2$ が存在して， $N = n_2, n_2 + 1, n_2 + 2, \ldots$ の全てについて $|f_2(N)| \leq c_2\cdot|g(N)|$ が成り立ちます．

   ここで， $c = c_1 + c_2$ とし， $n$ を $n_1$ と $n_2$ のうちの大きい方とします．すると， $N = n, n + 1, n + 2, \ldots$ の全てについて

   $$
   \begin{aligned}
   |f(N)|
   &= |f_1(N) + f_2(N)| \\
   &\leq |f_1(N)| + |f_2(N)| \\
   &\leq c_1\cdot|g(N)| + c_2\cdot|g(N)| \\
   &= c\cdot|g(N)|
   \end{aligned}
   $$

   が成り立ちます．
   :::
1. $f(N), g(N), h(N)$ があったとき， $f(N) = O(g(N))$ ならば $f(N)h(N) = O(g(N)h(N))$ ですか？
   :::details 答え
   **はい**．両辺に $|h(N)|$（ $\geq 0$ ）をかけても不等号の向きは変わらないので， $|f(N)| \leq c\cdot|g(N)|$ が成り立つなら

   $$
   \begin{aligned}
   |f(N)h(N)| &= |f(N)|\cdot|h(N)| \\
   &\leq c\cdot|g(N)|\cdot|h(N)| \\
   &= c\cdot|g(N)h(N)|
   \end{aligned}
   $$

   です．
   :::
1. 整数 $a, b$ について， $0 \leq a \leq b$ ならば $N^a = O(N^b)$ ですか？
   :::details 答え
   **はい**． $m = b - a$ とすると $m \geq 0$ です．このとき， $m > 0$ なら $N^m$ は単調増加なので $1 = O(N^m)$ です．また $m = 0$ のときも $N^0 = 1$ より $1 = O(N^m)$ です．あとは両辺に $N^a$ をかけて $N^a = O(N^b)$ を得ます．
   :::
1. $2N^3 + 5N^2 + N + 10 = O(N^3)$ ですか？
   :::details 答え
   **はい**． $2N^3 = O(N^3)$ ， $5N^2 = O(N^3)$ ， $N = O(N^3)$ ， $10 = O(N^3)$ より， $2N^3 + 5N^2 + N + 10 = O(N^3)$ です．
   :::
1. $\sqrt{N} = O(N)$ ですか？
   :::details 答え
   **はい**． $0 \leq a \leq b \Rightarrow N^a = O(N^b)$ は $a, b$ が整数でなくても実数のとき成り立ちます．
   :::
1. $2^N = O(N^{100})$ ですか？
   :::details 答え
   **いいえ**．どんな $m > 0$ に対しても $2^N = O(N^m)$ は成り立ちません．
   :::
1. $3^N = O(2^N)$ ですか？
   :::details 答え
   **いいえ**． $a > b > 1$ ならば $a^N = O(b^N)$ は成り立ちません．
   :::
1. $\log_2N = O(\log_3N)$ ですか？
   :::details 答え
   **はい**． $a > 1, b > 1$ ならば $\log_aN = \log_ab \cdot \log_bN$ より $\log_aN = O(\log_bN)$ が成り立ちます．
   :::
1. $\log{N} = O(\sqrt{N})$ ですか？
   :::details 答え
   **はい**．どんな $m > 0$ に対しても $\log{N} = O(N^m)$ が成り立ちます．
   :::
## 計算量と実行時間
最初の問題に戻って， 2 つのアルゴリズムの計算量をランダウの $O$ を用いて評価してみます．

解法 1 のアルゴリズムでは，各ループの中で $x + y + z = N$ と $10000x + 5000y + 1000z = Y$ を確かめるために何度かの足し算と掛け算と比較が行われます．しかし，一回のループにおける計算の回数は $N$ によって変化しません．よって，この部分だけで見ると計算量は $O(1)$ です．この $O(1)$ の処理は， $x, y, z$ のそれぞれが $0, 1, 2, \ldots, N$ の範囲を動くことで $(N + 1)^3$ 回繰り返されます．よって，全体の計算量は $O(1 \cdot (N + 1)^3) = O(N^3 + 3N^2 + 3N + 1) = O(N^3)$ となります．これが，ランダウの $O$ で表現したこのアルゴリズムの計算量です．

一方，解法 2 のアルゴリズムでも，各ループの中で $O(1)$ の処理が行われます．しかし今回は $x, y$ の 2 つだけが $0, 1, 2, \ldots, N$ の範囲を動くので，計算量は $O((N + 1)^2) = O(N^2 + 2N + 1) = O(N^2)$ です．解法 1 のアルゴリズムと比べて，次数が 1 つ下がっています．

計算量をランダウの $O$ で表すと，おおよその実行時間を見積もることができます． $1$ 秒あたりに可能な計算の回数は，現在おおよそ $10^8$ 程度であると言われています．今回 $1 \leq N \leq 2000$ なので， $O(N^3)$ のアルゴリズムの実行時間は $2000^3 / 10^8 = 80$ 秒くらいになり， $O(N^2)$ のアルゴリズムの実行時間は $2000^2 / 10^8 = 0.04$ 秒くらいになります．こうすると，この問題の実行時間制限である $2$ 秒と比較したときに，前者は明らかに間に合わず，後者は明らかに間に合うことが分かるでしょう．

コンピュータの計算スピードは年々変化しています．昔と今では， $1$ 秒でできる計算回数の目安が変化しています．[この記事](https://qiita.com/drken/items/872ebc3a2b5caaa4a0d0)にもっと詳しい話が書いてあるので，読んでみてください．
