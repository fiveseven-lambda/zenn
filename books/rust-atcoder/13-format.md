---
title: "フォーマット出力"
---

# フォーマット文字列
`println!` マクロの 1 つめの引数となる文字列リテラルを**フォーマット文字列**といいます．フォーマット文字列の中のプレースホルダーは，続く引数の値で置き換えられます．

```rust
fn main() {
    let a = 120;
    let b = 450;
    println!("{} + {} = {}", a, b, a + b);
}
```
```:stdout
120 + 450 = 570
```
今までは `{}` の中身が常に空でした．この章では， `{}` の中身でより詳細なフォーマットを指定する方法を紹介します．

ここで紹介する書き方は， `print!` マクロや `assert!` マクロなど他のいくつかのマクロでも使用できます．
# 順番
フォーマット文字列中に複数のプレースホルダーが存在したとき，今までは最初の引数が最初のプレースホルダー， 2 番目の引数が 2 番目のプレースホルダー……という順に置き換えられていました．
```rust
fn main() {
    println!("{} {} {} {} {}", -2, 10, 2.4, 30, 4.5);
}
```
```:stdout
-2 10 2.4 30 4.5
```
`{}` の中に数字を書いて，この順番を変更することができます．
```rust
fn main() {
    println!("{2} {3} {0} {4} {1}", -2, 10, 2.4, 30, 4.5);
}
```
![](https://storage.googleapis.com/zenn-user-upload/humiekrhwzp58cnrbgp9wdnqyvst)
```:stdout
2.4 30 -2 4.5 10
```
これを使うと同じ値を複数回出力することもできます．
```rust
fn main() {
    println!("{0} {0} {1} {1}", -2, 10);
}
```
```:stdout
-2 -2 10 10
```
また，これを数字で指定する代わりに，一時的に名前を付けて使うこともできます．
```rust
fn main() {
    println!("{hoge} {fuga} {hoge}", hoge = -2, fuga = 10);
}
```
```:stdout
-2 10 -2
```
単に `-2` と書く代わりに `hoge = -2` と書くと，フォーマット文字列中の `{hoge}` が `-2` で置き換えられます．
# フォーマット形式
プレースホルダーで，コロン `:` に続く部分はフォーマットの形式を表します．
```rust
fn main() {
    println!("{:6}", 79);
}
```
`:` の後の `6` は， 6 桁で出力するということを意味します．たとえば 2 桁の整数 79 なら，
```:stdout
79
```
と出力される代わりに，前に 4 文字の空白を付け加えて
```:stdout
    79
```
と出力されます．

`{0}` のような順番の指定と併用するときは， `{0:6}` のように書きます．

桁数の指定だけでなく，以下のように様々な指定が可能です．
|フォーマット形式|値|出力|説明|
|--|--|--|--|
|`{:6}`| 79 | `    79` | 6 桁（右寄せ） |
|`{:06}`| 79 | `000079` | 6 桁（0 埋め） |
|`{:<6}`| 79 | `79    ` | 6 桁（左寄せ） |
|`{:^6}`| 79 | `  79  ` | 6 桁（中央寄せ） |
|`{:+}`| 79 | `+79` | 符号を明示 |
|`{:b}`| 79 | `1001111` | 2 進法 |
|`{:10b}`| 79 | `   1001111` | 2 進法，10 桁（右寄せ） |
|`{:010b}`| 79 | `0001001111` | 2 進法，10 桁（0 埋め） |
|`{:#b}`| 79 | `0b1001111` | 2 進法（先頭に `0b`[^1] が付く） |
|`{:o}`| 79 | `117` | 8 進法 |
|`{:#o}`| 79 | `0o117` | 8 進法（先頭に `0o`[^1] が付く） |
|`{:x}`| 79 | `4f` | 16 進法（小文字） |
|`{:X}`| 79 | `4F` | 16 進法（大文字） |
|`{:#x}`| 79 | `0x4f` | 16 進法（先頭に `0x`[^1] が付く） |
|`{:.4}`| 2.71828183 | `2.7183` | 小数部分 4 桁（四捨五入） |
|`{:8.4}`| 3.14 | `  3.1400` | 小数部分 4 桁，全体で 8 文字（右寄せ） |
|`{:e}`| 299792458 | `2.99792458e8` | 指数表記（小文字の`e`） |
|`{:E}`| 299792458 | `2.99792458E8` | 指数表記（大文字の`E`） |

[^1]: 先頭の `0b`，`0o`，`0x` はそれぞれ 2 進法，8 進法，16 進法であることを意味します．この書き方はソースコード中の整数リテラルでも使えて，たとえば `0x4f` と書くと 16 進法の 4f になります．

書き方の一覧は[ここ](https://doc.rust-lang.org/std/fmt/)にあります．

# デバッグ出力
タプルや配列は，そのまま出力することができません．
```rust:コンパイルエラー
fn main() {
    let tuple = (10i32, 20i32, 30i32);
    println!("{}", tuple);
}
```
次のようなエラーになります．
```
error[E0277]: `(i32, i32, i32)` doesn't implement `std::fmt::Display`
 --> src/main.rs:3:20
  |
3 |     println!("{}", tuple);
  |                    ^^^^^ `(i32, i32, i32)` cannot be formatted with the default formatter
  |
```
タプルや配列を出力したいときは，たとえば
```rust
fn main() {
    let tuple = (10i32, 20i32, 30i32);
    println!("({}, {}, {})", tuple.0, tuple.1, tuple.2);
}
```
のように書く必要があります．

一方， `:` の後にクェスチョンマーク `?` を付けて `{:?}` とすると，タプルや配列をそのまま出力することができます．
```rust
fn main() {
    let tuple = (10i32, 20i32, 30i32);
    println!("{:?}", tuple);
}
```
```:stdout
(10, 20, 30)
```
これは，プログラムのどこかで異常が起きていると分かったとき，コード中に現れる変数の値をとにかく知りたいときに使われます．

`{:?}` を使うと，タプルや配列であってもその中身が*もらさず全て*出力されますが，形式などを細かく調整することはできず，次の 2 択になります．

- `{:?}` …… 一行で出力される．
  ```
  (10, 20, 30)
  ```
- `{:#?}` …… 改行をはさみながら出力される．
  ```
  (
      10,
      20,
      30,
  )
  ```
