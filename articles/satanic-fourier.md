---
title: "ãƒ“ãƒƒãƒˆæ¼”ç®—ã‚’ç”¨ã„ãŸéå†å¸° FFT"
emoji: "ğŸ”€"
type: "tech"
topics: ["ç«¶ãƒ—ãƒ­", "FFT"]
published: true
---

# é›¢æ•£ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆ DFT ï¼‰ã®å®šç¾©
$n$ å€‹ã®è¤‡ç´ æ•°åˆ— $\bm{x} = (x_0, x_1, \ldots, x_{n - 1})$ ã«å¯¾ã—ï¼Œã“ã‚Œã‚‰ã®**é›¢æ•£ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›**ï¼ˆ DFT ï¼‰ $\bm{X} = (X_0, X_1, \ldots, X_{n - 1})$ ã¯æ¬¡ã§å®šç¾©ã•ã‚Œã¾ã™ï¼

$$
X_k = \sum_{j = 0}^{n - 1} \zeta_n^{-jk} x_j
\tag{1}
$$

ãŸã ã— $\zeta_n$ ã¯

$$
\zeta_n = e^{\frac{2\pi i}{n}} = \cos\frac{2\pi}{n} + i\sin\frac{2\pi}{n}
$$

ã§å®šç¾©ã•ã‚Œï¼Œ $n$ ä¹—ã™ã‚‹ã¨ $1$ ã«ãªã‚‹è™šæ•°ã® 1 ã¤ã§ã™ï¼

$\zeta_{2n}$ ã® $2a$ ä¹—ã‚’è¨ˆç®—ã™ã‚‹ã¨ï¼Œ $\zeta_{2n}^{2a} = e^{\frac{2\pi i}{2n}\cdot 2a} = e^{\frac{2\pi i}{n} \cdot a}$ ã¨ãªã£ã¦ï¼Œ $\zeta_n$ ã® $a$ ä¹— $\zeta_n^a$ ã¨åŒã˜ã«ãªã‚Šã¾ã™ï¼

ã¾ãŸï¼Œ DFT ã®å®šç¾©å¼ $(1)$ ã¯ï¼Œæ•´æ•° $k$ ãŒ $0 \leq k < n$ ã®ç¯„å›²ã«ãªãã¦ã‚‚è¨ˆç®—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ $\zeta_n^{a + n} = \zeta_n^a \cdot \zeta_n^n = \zeta_n^a$ ã«æ³¨æ„ã™ã‚‹ã¨ï¼Œ $X_{k + n} = X_k$ ãŒæˆã‚Šç«‹ã¤ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ï¼ã‚ˆã£ã¦ï¼Œ $k$ ãŒ $0 \leq k < n$ ã®ç¯„å›²ã‚’è¶…ãˆãŸã¨ãã¯ï¼Œ $k$ ã®ä»£ã‚ã‚Šã«ï¼Œ $k$ ã‚’ $n$ ã§å‰²ã£ãŸä½™ã‚Šã§è€ƒãˆã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼

# æ™‚é–“é–“å¼•ãï¼ˆ DIT ï¼‰
$n$ ãŒå¶æ•°ã§ã‚ã‚‹ã¨ä»®å®šã—ï¼Œ $n = 2m$ ã¨ãŠãã¾ã™ï¼ã“ã®ã¨ãï¼Œé•·ã• $m$ ã®æ•°åˆ—ã® DFT ã‚’ç”¨ã„ã¦é•·ã• $n$ ã®æ•°åˆ—ã® DFT ã‚’è¡¨ã™ã“ã¨ã‚’è€ƒãˆã¾ã™ï¼

ã¾ãšï¼Œå®šç¾© $(1)$ ã‚ˆã‚Š

$$
\begin{aligned}
X_k &= \sum_{j = 0}^{n - 1} \zeta_n^{-jk} x_j \\
&= x_0 + \zeta_n^{-k} x_1 + \zeta_n^{-2k} x_2 + \cdots + \zeta_n^{-(n - 1)k} x_{n - 1}
\end{aligned}
$$

ã§ã™ãŒï¼Œã“ã“ã§å³è¾ºã‚’ $j$ ï¼ˆ $x$ ã®æ·»å­—ï¼‰ã®å¶å¥‡ã§ 2 ã¤ã«åˆ†ã‘ã¾ã™ï¼ã™ã‚‹ã¨ï¼Œ

$$
\begin{aligned}
X_k &= x_0 + \zeta_n^{-2k} x_2 + \zeta_n^{-4k} x_4 + \cdots + \zeta_n^{-(n - 2)k} x_{n - 2} \\
&+ \zeta_n^{-k} x_1 + \zeta_n^{-3k} x_3 + \zeta_n^{-5k} x_5 + \cdots + \zeta_n^{-(n - 1)k} x_{n - 1}
\end{aligned}
$$

ã¨ãªã‚Šã¾ã™ï¼ˆä¸ŠãŒå¶æ•°ï¼Œä¸‹ãŒå¥‡æ•°ï¼‰ï¼å¥‡æ•°ã®æ–¹ã¯ $\zeta_n^{-k}$ ã§ããã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼

$$
\begin{aligned}
X_k &= x_0 + \zeta_n^{-2k} x_2 + \zeta_n^{-4k} x_4 + \cdots + \zeta_n^{-(n - 2)k} x_{n - 2} \\
&+ \zeta_n^{-k} (x_1 + \zeta_n^{-2k} x_3 + \zeta_n^{-4k} x_5 + \cdots + \zeta_n^{-(n - 2)k} x_{n - 1})
\end{aligned}
$$

ã•ã‚‰ã«ï¼Œ $\zeta$ ã®æ·»å­—ã¨è‚©ã«ã‚ã‚‹ $n$ ã« $n = 2m$ ã‚’ä»£å…¥ã™ã‚‹ã¨

$$
\begin{aligned}
X_k &= x_0 + \zeta_{2m}^{-2k} x_2 + \zeta_{2m}^{-4k} x_4 + \cdots + \zeta_{2m}^{-2(m - 1)k} x_{n - 2} \\
&+ \zeta_n^{-k} (x_1 + \zeta_{2m}^{-2k} x_3 + \zeta_{2m}^{-4k} x_5 + \cdots + \zeta_{2m}^{-2(m - 1)k} x_{n - 1})
\end{aligned}
$$

ã¨ãªã‚Šã¾ã™ãŒï¼Œ $\zeta_{2m}^{2a} = \zeta_m^a$ ãŒæˆã‚Šç«‹ã¤ãŸã‚

$$
\begin{aligned}
X_k &= x_0 + \zeta_m^{-k} x_2 + \zeta_m^{-2k} x_4 + \cdots + \zeta_m^{-(m - 1)k} x_{n - 2} \\
&+ \zeta_n^{-k} (x_1 + \zeta_m^{-k} x_3 + \zeta_m^{-2k} x_5 + \cdots + \zeta_m^{-(m - 1)k} x_{n - 1})
\end{aligned}
$$

ã¨ãªã‚Šã¾ã™ï¼ã“ã®ã¨ãï¼Œä¸Šã¯é•·ã• $m$ ã®æ•°åˆ— $(x_0, x_2, x_4, \ldots, x_{n - 2})$ ã® DFT ã«ãªã£ã¦ã„ã¦ï¼Œä¸‹ã¯é•·ã• $m$ ã®æ•°åˆ— $(x_1, x_3, x_5, \ldots, x_{n - 1})$ ã® DFT ã«ãªã£ã¦ã„ã¾ã™ï¼

ã“ã®ã‚ˆã†ã«ï¼Œ $(x_0, x_2, x_4, \ldots, x_{n - 2})$ ã¨ $(x_1, x_3, x_5, \ldots, x_{n - 1})$ ã® DFT ã‚’ç”¨ã„ã¦ $(x_0, x_1, x_2, \ldots, x_{n - 1})$ ã® DFT ã‚’è¡¨ã™ã“ã¨ã‚’ï¼Œ**æ™‚é–“é–“å¼•ã**ï¼ˆ DIT ï¼‰ã¨ã„ã„ã¾ã™ï¼

# è¨˜æ³•ã®å°å…¥
$\bm{x} = (x_0, x_1, x_2, \ldots, x_{n - 1})$ ã®æ·»å­—ã‚’ 2 é€²æ³•ã§è¡¨ã—ãŸã¨ãï¼Œæœ€ä¸‹ä½ï¼ˆ 1 ã®ä½ï¼‰ãŒ $0$ ã§ã‚ã‚‹ã‚ˆã†ãªã‚‚ã®ã ã‘ã‚’å–ã£ã¦ããŸã‚‚ã®ã‚’ $\bm{x}_{:0} = (x_0, x_2, x_4, \ldots, x_{n - 2})$ ã¨ã—ã¾ã™ï¼åŒæ§˜ã«ï¼Œæœ€ä¸‹ä½ãŒ $1$ ã§ã‚ã‚‹ã‚ˆã†ãªã‚‚ã®ã ã‘ã‚’å–ã£ã¦ããŸã‚‚ã®ã‚’ $\bm{x}_{:1} = (x_1, x_3, x_5, \ldots, x_{n - 1})$ ã¨ã—ã¾ã™ï¼

æ¬¡ã«ï¼Œ $\bm{x}_{:0}$ ã® DFT ã‚’ $(X_{0:0}, X_{1:0}, X_{2:0}, \ldots, X_{m - 1:0})$ï¼Œ $\bm{x}_{:1}$ ã® DFT ã‚’ $(X_{0:1}, X_{1:1}, X_{2:1}, \ldots, X_{m - 1:1})$ ã¨ã—ã¾ã™ï¼

ã™ã‚‹ã¨ï¼Œä¸Šã® DIT ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ï¼

$$
X_k = X_{k:0} + \zeta_n^{-k} X_{k:1}
$$

# é«˜é€Ÿãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆ FFT ï¼‰
$m$ ã‚‚å¶æ•°ã¨ä»®å®šã—ã¦ $m = 2l$ ã¨ãŠãï¼Œ $\bm{x}_{:0}$ï¼Œ$\bm{x}_{:1}$ ã«å¯¾ã—ã¦ã•ã‚‰ã« DIT ã‚’ã‹ã‘ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã™ï¼

$\bm{x}$ ã®æ·»å­—ã‚’ 2 é€²æ³•ã§è¡¨ã—ï¼Œæœ€ä¸‹ä½ãŒ $0$ï¼Œ$1$ ã§ã‚ã‚‹ã‚ˆã†ãªã‚‚ã®ã‚’å–ã£ã¦ãã¦ï¼Œãã‚Œãã‚Œ $\bm{x}_{:0}$ï¼Œ$\bm{x}_{:1}$ ã¨ã—ãŸã®ã§ã—ãŸï¼åŒã˜æ“ä½œã‚’ $\bm{x}_{:0}$ ã«å¯¾ã—ã¦ã‚‚ã†ä¸€åº¦ã‚„ã‚‹ã¨ï¼Œä»Šåº¦ã¯ã€Œ$\bm{x}$ ã®æ·»å­—ã‚’ 2 é€²æ³•ã§è¡¨ã—ãŸã¨ãï¼Œä¸‹ 2 æ¡ãŒ $00$ï¼Œ$10$ ã§ã‚ã‚‹ã‚ˆã†ãªã‚‚ã®ã€ãŒå‡ºã¦ãã¾ã™ï¼ã“ã‚Œã‚’ãã‚Œãã‚Œ $\bm{x}_{:00}$ï¼Œ$\bm{x}_{:10}$ ã¨ã—ã¾ã™ï¼åŒæ§˜ã«ï¼ŒåŒã˜æ“ä½œã‚’ $\bm{x}_{:1}$ ã«å¯¾ã—ã¦ã‚„ã£ãŸã‚‚ã®ã‚’ $\bm{x}_{:01}$ï¼Œ$\bm{x}_{:11}$ ã¨ã—ã¾ã™ï¼ãã—ã¦ï¼Œå„ $\iota = 00, 01, 10, 11$ ã«ã¤ã„ã¦ï¼Œ $\bm{x}_{:\iota}$ ã® DFT ã‚’ $(X_{0:\iota}, X_{1:\iota}, X_{2:\iota}, \ldots, X_{l - 1:\iota})$ ã¨ã—ã¾ã™ï¼ˆå¤‰æ•° $\iota$ ã¯æ•´æ•°ã§ã¯ãªã $0$ ã¨ $1$ ã®ä¸¦ã³ã«ã¤ã‘ã‚‰ã‚ŒãŸåå‰ã ã¨æ€ã£ã¦ãã ã•ã„ï¼‰ï¼

ã™ã‚‹ã¨ï¼Œ $\bm{x}_{:0}$ï¼Œ$\bm{x}_{:1}$ ã® DFT ã«å¯¾ã™ã‚‹ DIT ã¯ãã‚Œãã‚Œ

$$
\begin{aligned}
X_{k:0} &= X_{k:00} + \zeta_m^{-k} X_{k:10} \\
X_{k:1} &= X_{k:01} + \zeta_m^{-k} X_{k:11}
\end{aligned}
$$

ã¨ãªã‚Šã¾ã™ï¼

ã‚‚ã— $n$ ãŒ $2$ ã®ã¹ãä¹—ãªã‚‰ã°ï¼Œã“ã‚Œã‚’æ•°åˆ—ã®é•·ã•ãŒ $1$ ã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™ã“ã¨ãŒã§ãã¾ã™ï¼æ•°åˆ— $\bm{x}_{:0\ldots00}$ï¼Œ$\bm{x}_{:0\ldots01}$ï¼Œ$\bm{x}_{:0\ldots10}$ï¼Œ$\ldots$ï¼Œ$\bm{x}_{:1\ldots11}$ ã®é•·ã•ãŒ $1$ ã«ãªã£ãŸã¨ãï¼Œã“ã‚Œã‚‰ã¯ $(x_0)$ï¼Œ$(x_1)$ï¼Œ$(x_2)$ï¼Œ$\ldots$ï¼Œ$(x_{n - 1})$ ã«ä»–ãªã‚Šã¾ã›ã‚“ï¼é•·ã• $1$ ã®æ•°åˆ—ã¯ DFT ã—ã¦ã‚‚å¤‰ã‚ã‚‰ãªã„ã®ã§ï¼Œ

$$
\begin{aligned}
(X_{0:0\ldots00}) &= (x_0) \\
(X_{0:0\ldots01}) &= (x_1) \\
(X_{0:0\ldots10}) &= (x_2) \\
\vdots \\
(X_{0:1\ldots11}) &= (x_{n - 1})
\end{aligned}
$$

ã¨ãªã‚Šã¾ã™ï¼

$X_k$ ã‚’æ±‚ã‚ã‚‹ã«ã¯ $X_{k:0}$ï¼Œ$X_{k:1}$ ãŒåˆ†ã‹ã‚Œã°ã‚ˆãï¼Œ $X_{k:0}$ï¼Œ$X_{k:1}$ ã‚’æ±‚ã‚ã‚‹ã«ã¯ $X_{k:00}$ï¼Œ$X_{k:01}$ï¼Œ$X_{k:10}$ï¼Œ$X_{k:11}$ ãŒåˆ†ã‹ã‚Œã°ã‚ˆã„ã®ã§ï¼Œ $X_{0:0\ldots00}$ï¼Œ$X_{0:0\ldots01}$ï¼Œ$X_{0:0\ldots10}$ï¼Œ$\ldots$ï¼Œ$X_{0:1\ldots11}$ ãŒåˆ†ã‹ã‚Œã°ï¼Œé€†ã«ãŸã©ã‚‹ã“ã¨ã§ $X_k$ ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼

ã“ã†ã—ã¦ï¼Œ DIT ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã«ã‚ˆã£ã¦ DFT ã‚’è¡Œã†ã®ãŒï¼Œ**é«˜é€Ÿãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›**ï¼ˆ FFT ï¼‰ã§ã™ï¼

# å®Ÿè£…
å®Ÿè£…ã®éš›ã¯ï¼Œ $X$ ã®æ·»å­— $k:\iota$ ã‚’ã€Œ $k$ ã® $2$ é€²æ³•è¡¨è¨˜ã¨ $\iota$ ã‚’ä¸¦ã¹ã¦æ›¸ã„ã¦ 1 ã¤ã®æ•°ã¨ã¿ãªã—ãŸã‚‚ã®ã€ã¨ã—ã¦æ‰±ã„ã¾ã™ï¼ãŸã¨ãˆã°ï¼Œ $k = 5$ï¼Œ $\iota = 10$ ãªã‚‰ã°ï¼Œ $k = 101_{(2)}$ ã¨ $10$ ã‚’ä¸¦ã¹ã¦æ›¸ãã¨ $10110_{(2)} = 22$ ãªã®ã§ï¼Œ $X[22]$ ã« $X_{5:10}$ ã®å€¤ãŒå…¥ã‚Šã¾ã™ï¼

ãŸã¨ãˆã°ï¼Œ Rust ã§ã®å®Ÿè£…ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼
```rust:FFT ã® Rust ã«ã‚ˆã‚‹å®Ÿè£…
fn fft(v: &mut Vec<Complex64>, n: u32) {
    let len = v.len();
    assert_eq!(len, 1 << n);
    let mask1 = len - 1; // k ãŒæ•°åˆ—ã®é•·ã•ã‚’è¶…ãˆãŸã¨ãã«å‰²ã£ãŸä½™ã‚Šã‚’ã¨ã‚‹ãƒã‚¹ã‚¯
    let zeta: Vec<_> = (0..len)
        .map(|i| Complex64::from_polar(1., -std::f64::consts::TAU * i as f64 / len as f64))
        .collect(); // ã‚¼ãƒ¼ã‚¿ã® 0 ä¹—ã‹ã‚‰ -(len - 1) ä¹—
    for i in 0..n {
        let mask2 = mask1 >> i + 1; // ã‚¤ã‚ªã‚¿ã®éƒ¨åˆ†ã‚’å¾—ã‚‹ãƒã‚¹ã‚¯
        *v = (0..len)
            .map(|j| {
                let lower = j & mask2; // ã‚¤ã‚ªã‚¿ã®éƒ¨åˆ†
                let upper = j ^ lower; // k ã®éƒ¨åˆ†
                let shift = upper << 1 & mask1;
                v[shift | lower] + zeta[upper] * v[shift | mask2 + 1 | lower]
            })
            .collect();
    }
}
```